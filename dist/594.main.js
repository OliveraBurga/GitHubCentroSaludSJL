"use strict";(self.webpackChunkpoliclinico=self.webpackChunkpoliclinico||[]).push([[594],{594:(t,e,n)=>{n.r(e),n.d(e,{default:()=>s});var a=n(178),i=n(110);let o,l,d={render:async(t,e="ATENCION")=>{$("#main").off(),t.innerHTML='\n\n        <div id="main">\n            \x3c!-- Content Header (Page header) --\x3e\n            <section class="content-header">\n                <div class="row">\n                    <div class="col-md-8 content-header" style="padding-top:5px;">\n                        <h1 style="margin:0; ">\n                            Atencion\n                            <small>Tesoreria</small>\n                        </h1>\n                    </div>\n                    <div class="col-md-4" align="right">\n                        <button type="button" class="btn btn-sm btn-warning" name="nuevo"><i class="fa fa-plus"></i> Nuevo</button>\n                    </div>\n                </div>\n                </section>\n\n                \x3c!-- Main content --\x3e\n                <section class="content">\n\n                \x3c!-- Default box --\x3e\n                <div class="box box-warning">\n                  <div class="box-body">\n                    <div class="row">        \n                      <div class="col-md-2">\n                        <div class="form-group">\n                            <label>Fecha Desde</label>\n                            <input type="date" name="fecha_inicio" id="fecha_inicio" class="form-control" autocomplete="off">\n                        </div>\n                      </div>\n                      <div class="col-md-2">\n                        <div class="form-group">\n                            <label>Fecha Hasta</label>\n                            <input type="date" name="fecha_fin" id="fecha_fin" class="form-control" autocomplete="off">\n                        </div>\n                      </div>\n                      <div class="col-md-1" style="padding-top:19px;">\n                        <button class="btn btn-warning" name="update_datatable"><i class="fa fa-search"></i> Buscar</button>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n                \x3c!-- /.box --\x3e\n\n                \x3c!-- Default box --\x3e\n                <div class="box box-warning">\n                    <div class="box-body">\n                    <div class="table-responsive">\n                        <table name="registros" class="table table-striped nowrap" style="width:100%;"></table>\n                    </div>\n                    </div>\n                </div>\n                \x3c!-- /.box --\x3e\n\n            </section>\n            \x3c!-- /.content --\x3e\n\n            \x3c!-- MODAL SAVE --\x3e\n            <div class="modal inmodal fade" name="modal-save" data-backdrop="static"  role="dialog" aria-hidden="true">\n                <div class="modal-dialog modal-lg">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\n                            <h4 name="save" class="modal-title">Modal title</h4>\n                        </div>\n                        <form name="save">\n                            <div class="modal-body">\n                                <div class="row">\n                                    <div class="col-md-4">\n                                        <div class="form-group">\n                                            <label>Fecha <span class="text-red">(*)</span></label>\n                                            <div class="form-group">\n                                            <input type="date" class="form-control" name="fecha" />\n                                            </div>                              \n                                        </div>\n                                    </div>\n                                    <div class="col-md-4">\n                                        <div class="form-group">\n                                            <label>Serie <span class="text-red">(*)</span></label>\n                                            <div class="form-group">\n                                            <input type="text" class="form-control" name="serie" disabled />\n                                            </div>                              \n                                        </div>\n                                    </div>\n                                    <div class="col-md-4">\n                                        <div class="form-group">\n                                            <label>Número <span class="text-red">(*)</span></label>\n                                            <div class="form-group">\n                                            <input type="text" class="form-control" name="numero" disabled/>\n                                            </div>                              \n                                        </div>\n                                    </div>\n                                    <div class="col-md-6">\n                                        <div class="form-group">\n                                            <label>Paciente <small>(*)</small></label>\n                                            <div class="form-group">\n                                            <select name="id_paciente" data-select="PACIENTE" class="form-control"></select>\n                                            </div>                              \n                                        </div>\n                                    </div>\n                                    <div class="col-md-6">\n                                        <div class="form-group">\n                                            <label>Personal <small>(*)</small></label>\n                                            <div class="form-group">\n                                            <select name="id_personal" data-select="PERSONAL" class="form-control"></select>\n                                            </div>                              \n                                        </div>\n                                    </div>\n                                    <div class="col-md-4">\n                                        <div class="form-group">\n                                            <label>Tipo Servicio  <small>(*)</small></label>\n                                            <select name="tipo_servicio" class="form-control select" >\n                                            <option value="ANALISIS CLINICO">ANALISIS CLINICO</option>\n                                            <option value="CONSULTA MEDICA">CONSULTA MEDICA</option>\n                                            </select>\n                                        </div>\n                                    </div>\n                                    <div class="col-md-4">\n                                        <div class="form-group">\n                                            <label>Servicio <small>(*)</small></label>\n                                            <div class="form-group">\n                                            <select name="id_servicio" data-select="SERVICIO" class="form-control"></select>\n                                            </div>                              \n                                        </div>\n                                    </div>\n                                    <div class="col-md-4">\n                                        <div class="form-group">\n                                            <label>Tarifa <small>(*)</small></label>\n                                            <div class="form-group">\n                                            <select name="id_tarifa" data-select="TARIFA" class="form-control"></select>\n                                            </div>                              \n                                        </div>\n                                    </div>\n                                    <div class="col-md-4">\n                                        <div class="form-group">\n                                            <label>Moneda <span class="text-red">(*)</span></label>\n                                            <select name="id_moneda" data-select="MONEDA" class="form-control select"></select>\n                                        </div>\n                                    </div>\n                                    <div class="col-md-4">\n                                        <div class="form-group">\n                                            <label>Tipo Cambio <span class="text-red">(*)</span></label>\n                                            <input type="number" step="any" name="tipo_cambio" class="form-control" autocomplete="off">\n                                        </div>\n                                    </div>  \n                                        \n                                    <div class="col-md-4">\n                                        <div class="form-group">\n                                            <label>Importe <span class="text-red">(*)</span></label>\n                                            <input type="number" name="importe" class="form-control" autocomplete="off">\n                                        </div>                         \n                                    </div>  \n                                    <div class="col-md-8">\n                                        <div class="form-group">\n                                            <label>Descripción <span class="text-red"> </span></label>\n                                            <input type="text" class="form-control" name="comentario" />                             \n                                        </div>\n                                    </div>\n                                    <div class="col-md-12" name="contenedor-detalle_importes">\n                                        <div class="row">\n                                            <div class="col-md-12">\n                                            <div class="table-responsive" >\n                                                <table class="table" style="width:100%; background-color:#DAEDFC; padding:10px;">\n                                                    <thead>\n                                                        <tr>\n                                                            <th>CANTIDAD</th>\n                                                            <th>SERVICIO</th>\n                                                            <th>COSTO UNITARIO</th>\n                                                            <th>PRECIO CONVENIO</th>\n                                                            <th>IMPORTE</th>\n                                                        </tr>\n                                                    </thead>\n                                                    <tbody name="detalle_importes"></tbody>\n                                                    <tfoot>\n                                                        <tr>\n                                                            <td colspan="2" align="center"><button type="button" name="agregar_item_costo" class="btn btn-primary"><i class="fa fa-plus"></i> Agregar Servicio</button></td>\n                                                            <td   align="right"><span name="total_costo" style="font-size:18px; color:#EA3838; font-weight:bold; text-align:left;"> 00</span> </td>\n                                                            <td   align="right"><span name="total_convenio" style="font-size:18px; color:#EA3838; font-weight:bold; text-align:left;"></span> </td>\n                                                            <td   align="right"> <span name="total_importe" style="font-size:18px; color:#EA3838; font-weight:bold; text-align:left;"></span></td>\n                                                        </tr>\n                                                    </tfoot>\n                                                </table>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>    \n                                                    \n                                </div>\n                            </div>\n                            <div class="modal-footer" align="center" style="display:block">\n                                <button type="button" name="cerrar" class="btn btn-white pull-left" data-dismiss="modal">Cerrar</button>\n                                <button type="submit" name="submit" class="btn btn-primary">Guardar</button>\n                            </div>\n                        </form>\n                    </div>\n                </div>\n            </div>\n\n            \x3c!-- MODAL DELETE --\x3e\n            <div class="modal inmodal fade" name="modal-delete" data-backdrop="static" tabindex="-1" role="dialog" aria-hidden="true">\n                <div class="modal-dialog modal-sm">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>\n                            <h4 name="delete" class="modal-title">Modal title</h4>\n                        </div>\n                        <form name="delete">\n                            <div class="row">\n                                <div class="col-md-12" align="center">\n                                    <i class="fad fa-trash-alt fa-4x"></i><br/>\n                                </div>\n                                <div class="col-md-12"  align="center" style="padding-top:10px;">\n                                    <label><input type="checkbox" name="confirmacion" required/>\n                                        Confirmo realizar la anulación</label>\n                                    <p style="color:red;">Esta acción no se podrá revertir</p>\n                                </div>\n                                <div class="col-md-12" name="texto" align="center">\n\n                                </div>\n                            </div>\n                            <div class="modal-footer" align="center" style="display:block" >\n                                <button type="button" name="cerrar" class="btn btn-white" data-dismiss="modal">Cerrar</button>\n                                <button type="submit" name="submit" class="btn btn-danger">Anular Ahora!</button>\n                            </div>\n                        </form>\n                    </div>\n                </div>\n            </div>\n        \n\n        </div>            \n        ',d.after_render(e)},after_render:async t=>{l="#main",o=$(l),o.find('form[name="save"]').validate({rules:{fecha:{required:!0},id_paciente:{required:!0},id_personal:{required:!0},id_tarifa:{required:!0},importe:{required:!0},id_servicio:{required:!0}},messages:{fecha:"Fecha",id_paciente:"Paciente",id_personal:"Personal",id_tarifa:"Tarifa",importe:"Importe",id_servicio:"Servicio"},submitHandler:function(){d.submit()}}),o.on("click",'button[name="update_datatable"]',(function(t){t.stopImmediatePropagation(),d.table.ajax.reload(null,!1)})),o.find('form[name="delete"]').validate({submitHandler:function(){d.submit()}}),o.on("click",'button[name="nuevo"]',(function(t){t.stopImmediatePropagation(),d.new()})),o.on("change",'select[name="id_tarifa"]',(function(t){t.stopImmediatePropagation(),1==d.fl_auto_event&&d.selec_precio()})),o.on("click",'button[name="row-print"]',(function(t){t.stopImmediatePropagation();let e=HELPER.get_attr_json($(this));console.log(e),d.print(e.id)})),o.on("click",'a[name="row-edit"]',(function(t){t.stopImmediatePropagation(),d.edit($(this))})),o.on("change",'select[name="id_moneda"]',(function(t){t.stopImmediatePropagation(),1==d.fl_auto_event&&d.change_moneda()})),o.on("click",'a[name="row-delete"]',(function(t){t.stopImmediatePropagation(),d.delete($(this))})),o.on("change",'select[name="tipo_servicio"]',(function(t){t.stopImmediatePropagation(),(d.fl_auto_event=!0)&&(d.select_servicio(),d.change_select_servicio())})),o.on("change",'select[name="id_servicio"]',(function(t){t.stopImmediatePropagation(),1==d.fl_auto_event&&d.select_tarifa()})),o.on("keyup",'input[data-name="detalle_importe-cantidad"]',(function(t){t.stopImmediatePropagation(),(d.fl_auto_event=!0)&&d.calcular_importe_detalle_importe($(this).data("codigo"))})),o.on("keyup",'input[data-name="detalle_importe-precio_convenio"]',(function(t){t.stopImmediatePropagation(),(d.fl_auto_event=!0)&&d.calcular_importe_detalle_importe($(this).data("codigo"))})),o.on("keyup",'input[data-name="detalle_importe-costo_unitario"]',(function(t){t.stopImmediatePropagation(),(d.fl_auto_event=!0)&&d.calcular_importe_detalle_importe($(this).data("codigo"))})),o.on("change",'select[data-name="id_servicio"]',(function(t){t.stopImmediatePropagation(),(d.fl_auto_event=!0)&&d.consultar_costo($(this).data("codigo"),$(this).val())})),o.on("click",'button[name="quitar-item"]',(function(t){t.stopImmediatePropagation(),d.quitar_item($(this)),(d.fl_auto_event=!0)&&(d.calcular_total_orden(),d.calcular_importe_total())})),o.on("click",'button[name="agregar_item_costo"]',(function(t){t.stopImmediatePropagation(),(d.fl_auto_event=!0)&&d.agregar_item_costo()})),o.find('input[name="fecha_inicio"]').val(HELPER.primer_dia_mes()),o.find('input[name="fecha_fin"]').val(HELPER.fecha_actual()),d.tipo=t,d.select_paciente(),d.select_personal(),d.select_moneda(),d.datatable(),HELPER.load_component()},id:null,action_submit:null,imagen_anterior:null,fl_auto_event:!0,tipo:null,agregar_item_costo:(t=null)=>{null==t&&(t={cantidad:1,id_servicio:"",costo_unitario:"",precio_convenio:"",importe:""});let e=Math.random().toString(36).substr(2),n='\n            <tr data-codigo="'+e+'">\n                \n                <td style="width:150px;"><input type="number" data-codigo="'+e+'" step="any" class="form-control" data-name="detalle_importe-cantidad" value="'+t.cantidad+'"  /></td>\n                <td><select data-select="SERVICIO" data-name="id_servicio" data-codigo="'+e+'" class="form-control"></select></td>\n                <td style="width:150px;"><input type="number" data-codigo="'+e+'" step="any" class="form-control" data-name="detalle_importe-costo_unitario" value="'+t.costo_unitario+'" /></td>\n                <td style="width:150px;"><input type="number" data-codigo="'+e+'" step="any" class="form-control" data-name="detalle_importe-precio_convenio" value="'+t.precio_convenio+'" /></td>\n                <td style="width:150px;"><input type="number" step="any" class="form-control" data-name="detalle_importe-importe" readonly value="'+t.importe+'" /></td>\n                <td><button type="button" name="quitar-item" class="btn btn-danger"><i class="fa fa-times"></i></button></td>\n            </tr>\n        ';o.find('tbody[name="detalle_importes"]').append(n),d.select__servicio(e,t.id_servicio)},select__servicio:async(t=null,e="")=>{o.find('tr[data-codigo="'+t+'"] select[data-select="SERVICIO"]').html("");let n=o.find('tr[data-codigo="'+t+'"] select[data-select="SERVICIO"]');n.append($("<option></option>").attr("value","").text("Seleccione...")),d.array_sevicios.forEach((t=>{n.append('<option value="'+t.id+'">'+t.text+"</option>")})),n.val(e),n.select2()},quitar_item:t=>{var e=t.parents("tr")[0].dataset.codigo;$('tr[data-codigo="'+e+'"]').remove()},calcular_importe_detalle_importe:t=>{let e=o.find('tr[data-codigo="'+t+'"]'),n=e.find('input[data-name="detalle_importe-cantidad"]').val();n=parseFloat(""!=n?n:0);let a=e.find('input[data-name="detalle_importe-costo_unitario"]').val();a=parseFloat(""!=a?a:0);let i=n*a;i=Math.round(100*i)/100,e.find('input[data-name="detalle_importe-importe"]').val(i.toFixed(2)),d.calcular_total_orden(),d.calcular_importe_total()},get_detalle_importes:()=>{let t=[];return o.find('tbody[name="detalle_importes"] tr').each((function(){t.push({cantidad:$(this).find('input[data-name="detalle_importe-cantidad"]').val(),id_servicio:$(this).find('select[data-name="id_servicio"]').val(),costo_unitario:$(this).find('input[data-name="detalle_importe-costo_unitario"]').val(),precio_convenio:$(this).find('input[data-name="detalle_importe-precio_convenio"]').val(),importe:$(this).find('input[data-name="detalle_importe-importe"]').val()})})),t},calcular_importe_total:async()=>{let t=0,e=0,n=0;o.find('tbody[name="detalle_importes"] tr').each((function(){let a=parseFloat($(this).find('input[data-name="detalle_importe-costo_unitario"]').val()),i=parseFloat($(this).find('input[data-name="detalle_importe-precio_convenio"]').val()),o=parseFloat($(this).find('input[data-name="detalle_importe-importe"]').val());t+=a,e+=i,n+=o})),o.find('span[name="total_costo"]').text(t.toFixed(2)),o.find('span[name="total_convenio"]').text(e.toFixed(2)),o.find('span[name="total_importe"]').text(n.toFixed(2))},calcular_total_orden:async()=>{let t=o.find('input[name="importe"]').val();t=parseFloat(0),t=Math.round(100*t)/100,o.find('tbody[name="detalle_importes"] tr').each((function(){let e=$(this).find('input[data-name="detalle_importe-importe"]').val();e=parseFloat(""!=e?e:0),t+=e})),o.find('input[name="importe"]').val(t.toFixed(2))},change_fl_detalle_importes:()=>{o.find('input[name="fl_detalle_importes"]').is(":checked")?o.find('div[name="contenedor-detalle_importes"]').show("fast"):o.find('div[name="contenedor-detalle_importes"]').hide("fast")},consultar_costo:async(t,e)=>{o.find('tr[data-codigo="'+t+'"] select[data-name="id_servicio"]').val(),await axios.get(BASE_API+"configuracion/tarifa/get_select_unique_costo/"+e).then((function(e){console.log(t),o.find('tr[data-codigo="'+t+'"] input[data-name="detalle_importe-costo_unitario"]').val(e.data.costo),o.find('tr[data-codigo="'+t+'"] input[data-name="detalle_importe-precio_convenio"]').val(e.data.precio_convenio)})).catch((t=>{console.log(t)})),d.calcular_importe_detalle_importe(t)},select_paciente:async()=>{o.find('select[data-select="PACIENTE"]').select2({ajax:{url:BASE_API+"configuracion/socio/get_select?fl_cliente=true",dataType:"json",delay:250,data:function(t){return{buscar:t.term}},processResults:function(t,e){return{results:t}},cache:!0},escapeMarkup:function(t){return t},placeholder:"Buscar Razón Social o Número de Documento",minimumInputLength:6,allowClear:!0})},change_moneda:async(t=!0)=>{let e=o.find('select[name="id_moneda"]').val();1==e?(o.find('input[name="tipo_cambio"]').prop("disabled",!0),o.find('input[name="tipo_cambio"]').val("")):""!=e&&(o.find('input[name="tipo_cambio"]').prop("disabled",!1),t&&o.find('input[name="tipo_cambio"]').val(await HELPER.get_tipo_cambio(e)))},select_moneda:async()=>{let t=o.find('select[data-select="MONEDA"]');await axios.get(BASE_API+"recursos/data_static/moneda").then((function(e){let n='<option value="">Seleccione...</option>';e.data.forEach((t=>{n+='<option value="'+t.id+'">'+t.text+"</option>"})),t.html(n),t.select2()})).catch((t=>{console.log(t)}))},select_personal:function(){let t=o.find('select[data-select="PERSONAL"]');t.append($("<option></option>").attr("value","").text("Seleccione...")),axios.get(BASE_API+"configuracion/personal/get_select").then((function(e){e.data.forEach((e=>{t.append('<option value="'+e.id+'">'+e.text+"</option>")})),t.select2()})).catch((t=>{console.log(t)}))},change_select_servicio:async(t=null)=>{"CONSULTA MEDICA"==o.find('select[name="tipo_servicio"]').val()?(o.find('select[name="id_servicio"]').prop("disabled",!1),o.find('select[name="id_tarifa"]').prop("disabled",!1),o.find('div[name="contenedor-detalle_importes"]').hide()):(o.find('select[name="id_servicio"]').prop("disabled",!0),o.find('select[name="id_tarifa"]').prop("disabled",!0),o.find('div[name="contenedor-detalle_importes"]').show())},select_servicio1:async t=>{await axios.get(BASE_API+"configuracion/tipo_servicio/get_select?tipo="+t).then((async function(t){d.array_sevicios=t.data})).catch((t=>{console.log(t)}))},select_servicio:async(t=null)=>{let e=o.find('select[data-select="SERVICIO"]'),n=o.find('select[name="tipo_servicio"]').val();e.empty(),e.append($("<option></option>").attr("value","").text("Seleccione...")),await axios.get(BASE_API+"configuracion/tipo_servicio/get_select?tipo="+n).then((async function(n){d.array_sevicios=n.data,n.data.forEach((t=>{e.append('<option value="'+t.id+'">'+t.text+"</option>")})),e.select2(),null!=t&&(e.val(t).change(),d.id_servicio_nuevo=t)})).catch((t=>{console.log(t)}))},select_tarifa:function(t=null){let e=o.find('select[data-select="TARIFA"]'),n=o.find('select[name="id_servicio"]').val(),a=o.find('select[name="id_paciente"]').val();o.find('select[data-select="TARIFA"]').html(""),e.append($("<option></option>").attr("value","").text("Seleccione...")),axios.get(BASE_API+"configuracion/tarifa/get_select?id_servicio="+n+"&id_cliente="+a).then((function(n){n.data.forEach((t=>{e.append('<option value="'+t.id+'">'+t.text+"</option>")})),e.select2(),null!=t&&e.val(t).change()})).catch((t=>{console.log(t)}))},selec_precio:function(){let t=o.find('select[name="id_tarifa"]').val();t>0&&axios.get(BASE_API+"configuracion/tarifa/get_unique?id="+t).then((function(t){o.find('input[name="importe"]').val(t.data.importe)})).catch((t=>{console.log(t)}))},datatable:function(){this.table=o.find('table[name="registros"]').DataTable({ajax:{url:BASE_API+"operacion/atencion",data:function(t){t.fecha_inicio=o.find('input[name="fecha_inicio"]').val(),t.fecha_fin=o.find('input[name="fecha_fin"]').val(),t.tipo=d.tipo}},columns:[{title:"ID",mData:"id"},{title:"ACCIÓN",defaultContent:"",render:function(t,e,n){return'\n                            <div class="btn-group" style="width:120px;">\n                                <button type="button" class="btn btn-default btn-sm" name="row-print">VISUALIZAR</button>     \n                                <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">\n                                      <i class="fa fa-angle-down"></i>\n                                </button>\n                                <ul class="dropdown-menu dropdown-menu-left" role="menu">\n                                    <li><a class="dropdown-item" name="row-edit" href="javascript:"><i class="far fa-pencil"></i> Editar</a></li>\n                                    <li><a class="dropdown-item" name="row-delete" href="javascript:"><i class="far fa-ban"></i> Anular</a></li>\n                                </ul>\n                            </div>\n                        '},width:"100px"},{title:"FECHA",render:function(t,e,n){return HELPER.fecha(n.fecha)}},{title:"NÚMERO",mData:"atencion"},{title:"PERSONAL",mData:"personal"},{title:"PACIENTE",mData:"paciente"},{title:"TIPO SERVICIO",mData:"tipo"},{title:"SERVICIO",mData:"servicio"},{title:"TARIFA",mData:"tarifa"},{title:"IMPORTE",mData:"importe"},{title:"ESTADO",defaultContent:"",render:function(t,e,n){let a="";return 1==n.fl_estado?a='\n                                <small class="label label-default"> REGISTRADO</small>\n                            ':2==n.fl_estado?a='\n                                <small class="label label-primary"> CON TRIAJE</small>\n                            ':3==n.fl_estado&&(a='\n                                <small class="label label-success"> ATENDIDO</small>\n                            '),"ANALISIS CLINICO"==n.tipo&&(a='\n                            <small class="label label-default"> REGISTRADO</small>\n                          ',"ATENDIENDO"==n.estado?a='\n                                     <small class="label label-success"> ATENDIENDO</small>\n                                 ':"FINALIZADO"==n.estado&&(a='\n                                     <small class="label label-primary"> FINALIZADO</small>\n                                 ')),0==n.fl_estado&&(a='\n                                <small class="label label-danger"> ANULADO</small>\n                            '),a}},{title:"COMENTARIO",mData:"comentario"}],createdRow:function(t,e,n){$(t).attr("data-json",JSON.stringify(e)),0==e.fl_estado&&($(t).css("text-decoration","line-through"),$(t).css("color","red"))}})},get_correlativo:async()=>{await axios.get(BASE_API+"operacion/atencion/get_correlativo").then((function(t){o.find('input[name="numero"]').val(t.data.numero),o.find('input[name="serie"]').val(t.data.serie)})).catch((t=>{console.log(t)}))},new:function(){o.find('tbody[name="detalle_importes"]').html("");let t=o.find('form[name="save"]');o.find('h4[name="save"]').text("Nueva Atencion"),HELPER.reset_form(t),t.find('input[name="fecha"]').val(HELPER.fecha_actual()),o.find('select[name="tipo_servicio"]').val("CONSULTA MEDICA").change(),this.get_correlativo(),t.find('select[name="id_moneda"]').val(1).change(),t.find('select[name="id_local"]').val(GLOBAL.usuario.id_local).change(),this.id=null,this.action_submit="save",o.find('div[name="modal-save"]').modal("show")},edit:async t=>{let e=o.find('form[name="save"]');o.find('h4[name="save"]').text("Editar Atención"),o.find('tbody[name="detalle_importes"]').html(""),HELPER.reset_form(e);let n=HELPER.get_attr_json(t);d.fl_auto_event=!1,e.find('input[name="fecha"]').val(n.fecha),e.find('input[name="serie"]').val(n.serie),e.find('input[name="numero"]').val(n.numero),null!=n.id_paciente&&(e.find('select[name="id_paciente"]').html(""),e.find('select[name="id_paciente"]').append(new Option(n.paciente,n.id_paciente))),e.find('input[name="descripcion"]').val(n.descripcion),e.find('input[name="motivo"]').val(n.motivo).change(),e.find('select[name="modalidad"]').val(n.modalidad).change(),e.find('select[name="id_personal"]').val(n.id_personal).change(),e.find('select[name="id_moneda"]').val(n.id_moneda).change(),e.find('input[name="importe"]').val(n.importe),e.find('input[name="tipo_cambio"]').val(n.tipo_cambio),e.find('select[name="tipo_servicio"]').val(n.tipo).change(),e.find('input[name="comentario"]').val(n.comentario),"CONSULTA MEDICA"==n.tipo?(await d.select_servicio(n.id_servicio),await d.select_tarifa(n.id_tarifa)):await d.select_servicio1(n.tipo),await d.change_moneda(!1),e.find('select[name="id_tarifa"]').val(n.id_tarifa).change(),n.detalle_importes.forEach((t=>{d.agregar_item_costo(t)})),d.fl_auto_event=!0,d.id=n.id,d.action_submit="save",o.find('div[name="modal-save"]').modal("show")},delete:function(t){let e="delete",n=o.find('form[name="'+e+'"]');o.find('h4[name="'+e+'"]').text("Anular Atención"),HELPER.reset_form(n);let a=HELPER.get_attr_json(t);n.find('div[name="texto"]').text(a.serie+"-"+a.numero),this.id=a.id,this.action_submit=e,o.find('div[name="modal-'+e+'"]').modal("show")},submit:function(){let t=HELPER.ladda(l+' form[name="'+this.action_submit+'"] button[type="submit"]'),e=new FormData(document.querySelector(l+' form[name="'+this.action_submit+'"]'));null!=this.id&&e.append("id",this.id),e.append("detalle_importes",JSON.stringify(d.get_detalle_importes())),e.append("tipo",d.tipo),axios({method:"post",url:BASE_API+"operacion/atencion/"+this.action_submit,data:e}).then((function(e){d.table.ajax.reload(null,!1),o.find('div[name="modal-'+d.action_submit+'"]').modal("hide"),HELPER.notificacion(e.data.mensaje,"success"),"save"==d.action_submit&&i.Z.print(e.data.id_atencion),t.stop()})).catch((e=>{t.stop()}))},print:async t=>{await axios.get(BASE_API+"operacion/atencion/print/"+t).then((function(t){t.data,d.ticket(t.data)})).catch((t=>{console.log(t)}))},ticket:async t=>{let e='\n            <style>\n                td{\n                    padding:1px;\n                }\n\n            </style>\n            \n            <table border="0" cellspacing="0" cellpadding="0" style="font-family:Arial, Helvetica, sans-serif; font-size:14px; max-width:350px;">\n                <tr>\n                    <td style="text-align:center;">\n                        <img src="'+BASE_FILES+"images/"+t.empresa.logo_factura+'" style="width:250px;" />\n                    </td>\n                </tr>\n                <tr>\n                    <td>\n                        <table width="100%" border="0" cellspacing="0" cellpadding="4">\n                            <tr>\n                                <td align="center">'+t.empresa.razon_social+'</td>\n                            </tr>\n                            <tr>\n                                <td align="center">RUC: '+t.empresa.numero_documento+'</td>\n                            </tr>\n                            <tr>\n                                <td align="center">'+t.empresa.direccion+'</td>\n                            </tr>\n                        </table>\n                    </td>\n                </tr>\n                <tr>\n                    <td>\n                        <table width="100%" border="0" cellspacing="0" cellpadding="4">\n                            <tr>\n                                <td align="center" style="font-size:18px; font-weight:bold;">ATENCIÓN</td>\n                            </tr>\n                            <tr>\n                                <td align="center" style="font-size:18px;">'+t.atencion+'</td>\n                            </tr>\n                        </table>\n                    </td>\n                </tr> \n                <tr>\n                    <td style="text-align:center;">\n                        Fecha de Registro: '+HELPER.fecha(t.fecha)+'\n                    </td>\n                </tr>              \n                <tr>\n                    <td style="padding-bottom:10px;">\n                        <table width="100%" border="0" cellspacing="0" cellpadding="5">\n                            <tr>\n                                <td>Paciente: </td>\n                                <td style="text-align:right;">'+t.paciente+'</td>\n                            </tr>\n                            <tr>\n                                <td>Personal:</td>\n                                <td style="text-align:right;">'+t.personal+'</td>\n                            </tr>\n\n                            <tr>\n                                <td>Tipo Servicio:</td>\n                                <td style="text-align:right;">'+t.tipo+"</td>\n                            </tr>\n                            ";if("CONSULTA MEDICA"==t.tipo&&(e+='\n\n\n                           \n                            <tr>\n                                <td>Servicio:</td>\n                                <td style="text-align:right;">'+t.servicio+'</td>\n                            </tr>\n\n\n                            <tr>\n                                <td>Importe:</td>\n                                <td style="text-align:right;">'+t.importe+"</td>\n                            </tr>\n\n                            "),e+='\n                        </table>\n                    </td>\n                </tr>\n                <tr>\n                    <td style="border-top:dashed 1px #000;"></td>\n                </tr>\n\n                ',"ANALISIS CLINICO"==t.tipo){e+='\n\n                <tr>\n                <td>\n                    <table width="100%" border="0" cellspacing="0" cellpadding="5">\n                        <thead>\n                            <tr>\n                                <th style="text-align:center;">ITEM</th>\n                                <th style="text-align:center;">CANTIDAD</th>\n                                <th>SERVICIO</th>\n                                <th style="text-align:right;">PRECIO</th>\n                                <th align="right">IMPORTE</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            ';let n=1;t.detalle_importes.forEach((t=>{e+='\n                                    <tr>\n                                    <td style="text-align:center;">'+n+'</td>\n                                        <td style="text-align:center;">'+t.cantidad+"</td>\n                                        <td>"+t.servicio+'</td>\n                                     \n                                        <td style="text-align:right;">'+parseFloat(t.costo_unitario).toFixed(2)+'</td>\n                                        <td style="text-align:right;">'+t.importe+"</td>\n                                    </tr>\n                                ",n++})),e+='\n                            \n                        </tbody>\n                        <tfoot>\n                           \n                            \n                            <tr>\n                                <td></td>\n                                <td colspan="3" style="text-align:right; font-weight:bold;">TOTAL IMPORTE</td>\n                                <td align="right" style="font-weight:bold;">S/ '+t.importe+"</td>\n                            </tr>\n                        </tfoot>                           \n                        \n                    </table>                \n                </td>\n            </tr> \n            "}e+='\n                <tr>\n                    <td style="text-align:center;">\n                        '+a.Z.convertir(t.importe,"SOLES")+"\n                     </td>\n                </tr>",e+='    \n                <tr>\n                    <td style="padding-top:10px; padding-bottom:10px;"><div style="border-top:dashed 1px #000;"></div></td>\n                </tr>\n \n                \n\n            </table>\n \n        ',await HELPER.print(e)}};const s=d}}]);